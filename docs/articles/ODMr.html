<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ODMr • ODMr</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ODMr">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ODMr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/ODMr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ODM_notes.html">ODM notes</a>
    </li>
    <li>
      <a href="../articles/Woking_ODMr.html">Working with ODMr</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><script src="ODMr_files/htmlwidgets-1.2/htmlwidgets.js"></script><script src="ODMr_files/jquery-1.11.1/jquery.min.js"></script><link href="ODMr_files/dygraphs-1.1.1/dygraph.css" rel="stylesheet">
<script src="ODMr_files/dygraphs-1.1.1/dygraph-combined.js"></script><script src="ODMr_files/dygraphs-1.1.1/shapes.js"></script><script src="ODMr_files/moment-2.8.4/moment.js"></script><script src="ODMr_files/moment-timezone-0.2.5/moment-timezone-with-data.js"></script><script src="ODMr_files/moment-fquarter-1.0.0/moment-fquarter.min.js"></script><script src="ODMr_files/dygraphs-binding-1.1.1.5/dygraphs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>ODMr</h1>
                        <h4 class="author">Chris McConnell</h4>
            
            <h4 class="date">2018-07-11</h4>
      
      
      <div class="hidden name"><code>ODMr.Rmd</code></div>

    </div>

    
    
<p>This is an R package for working with an instance of the CUAHSI ODM running on MS-SQL. Works in our office, may or may not be useful to others outside our work-site.</p>
<div id="odbc" class="section level2">
<h2 class="hasAnchor">
<a href="#odbc" class="anchor"></a>ODBC</h2>
<p>In order to talk to the database, you’ll need to define an ODBC connection on the machine that you’re working on. To do this, go to Control Panel -&gt; Administrative Tools, then choose “Data Sources (ODBC)”. You’ll want to add a “User DSN”.</p>
<p>At this point, it’ll ask you which driver you want to use. You’ll want to choose SQL Server and click finish. Next you’ll want to specify which database you want to talk to. You’ll see a dialogue box with three boxes for you to fill in.</p>
<p>Click next and choose that you want to connect with SQL Server authentication using a username and password given to you by the administrator.</p>
<p>Click “Next” again, and it’ll contact the database to make sure that you have the appropriate permissions. Make sure that you have the “OD” database selected as the default database. Click next again, then finish, and finally, click “Test Data Source” to make sure that everything ran properly.</p>
</div>
<div id="the-basics" class="section level2">
<h2 class="hasAnchor">
<a href="#the-basics" class="anchor"></a>The Basics</h2>
<p>This will all be easier to use and understand if you have a fundamental understanding of the underlying data model. The model and the underlying motives for it’s design can be found at <a href="http://www.cuahsi.org" class="uri">http://www.cuahsi.org</a></p>
<p>Here is a quick example. You’ll need the package RODBC in order to establish a connection using an ODBC connection. <code><a href="http://www.rdocumentation.org/packages/DBI/topics/dbConnect">DBI::dbConnect()</a></code> establishes a connection to the specified DSN and <code><a href="../reference/ODMgetCatalog.html">ODMgetCatalog()</a></code> can be used to import the series catalog.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(ODMr)
ODM &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/DBI/topics/dbConnect">dbConnect</a></span>(odbc<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/odbc/topics/odbc">odbc</a></span>(), <span class="dt">dsn =</span> <span class="st">"ODM"</span>, <span class="dt">database =</span> <span class="st">"OD"</span>, <span class="dt">UID =</span> <span class="st">"update"</span>, 
    <span class="dt">PWD =</span> <span class="st">"update"</span>, <span class="dt">Port =</span> <span class="dv">1433</span>)
Catalog =<span class="st"> </span><span class="kw"><a href="../reference/ODMgetCatalog.html">ODMgetCatalog</a></span>()</code></pre></div>
<p>Using the established connection and referencing the series catalog we can import data from the database. The series catalog is not stable so only refernce series IDs to quickly look at certain data.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ODMgetData.html">ODMgetData</a></span>(<span class="dt">SeriesID =</span> <span class="dv">10</span>, <span class="dt">startDate =</span> <span class="st">"2013-06-01"</span>,
  <span class="dt">endDate =</span> <span class="st">"2014-06-01"</span>)</code></pre></div>
<p>A more stable reference can be had by specifying SiteID, VariableID, MethodID and QualityControlLevelID.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ODMgetData.html">ODMgetData</a></span>(<span class="dt">SiteID =</span> <span class="dv">15</span>, <span class="dt">VariableID =</span> <span class="dv">3</span>, <span class="dt">MethodID =</span> <span class="dv">1</span>, <span class="dt">QualityControlLevelID =</span> <span class="dv">1</span>,
                  <span class="dt">startDate =</span> <span class="st">"2016-03-01"</span>, <span class="dt">endDate =</span> <span class="st">"2016-06-01"</span>)</code></pre></div>
<p>Multiple data series can be queried at once. The function makes use of the IN operator in the underlying SQL statement to specify multiple values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">Data &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ODMgetData.html">ODMgetData</a></span>(<span class="dt">SiteID =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">5</span>) , <span class="dt">VariableID =</span> <span class="dv">1</span>, <span class="dt">MethodID =</span> <span class="dv">9</span>,
  <span class="dt">QualityControlLevelID =</span> <span class="dv">0</span>, <span class="dt">startDate =</span> <span class="st">"2013-06-01"</span>, <span class="dt">endDate =</span> <span class="st">"2013-07-01"</span>)</code></pre></div>
</div>
<div id="addins" class="section level2">
<h2 class="hasAnchor">
<a href="#addins" class="anchor"></a>Addins</h2>
<p>There are a number of addins included in the package. Once the package is installed they should be available under Addins on the main application toolbar of Rstudio.</p>
<p><code><a href="../reference/ODMDashboard.html">ODMDashboard()</a></code> provides a simple GUI to access and download data from ODM.</p>
<p><code><a href="../reference/ODMtools.html">ODMtools()</a></code> provides an interactive way of viewing, validating, and/or correcting values.</p>
</div>
<div id="visualising-data" class="section level2">
<h2 class="hasAnchor">
<a href="#visualising-data" class="anchor"></a>Visualising Data</h2>
<p>Base graphics is the default graphics system in R, the easiest to learn to use, but is static.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(Data<span class="op">$</span>LocalDateTime, Data<span class="op">$</span>DataValue)</code></pre></div>
<p><img src="ODMr_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>The dygraphs package offers an R interface to the dygraphs JavaScript charting library. It provides rich facilities for charting time-series data in R, including interactive features including zoom/pan and series/point highlighting.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dygraphs)
Data <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span>xts<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/xts/topics/xts">xts</a></span>(<span class="dt">x =</span> .<span class="op">$</span>DataValue, <span class="dt">order.by =</span> .<span class="op">$</span>LocalDateTime) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">dygraph</span>()</code></pre></div>
<div id="htmlwidget-2f35041b003b895ae967" style="width:700px;height:432.632880098888px;" class="dygraphs html-widget"></div>
<script type="application/json" data-for="htmlwidget-2f35041b003b895ae967">{"x":{"attrs":{"labels":["day","V1"],"legend":"auto","retainDateWindow":false,"axes":{"x":{"pixelsPerLabel":60}}},"scale":"daily","annotations":[],"shadings":[],"events":[],"format":"date","data":[["2016-03-01T05:00:00.000Z","2016-03-02T05:00:00.000Z","2016-03-03T05:00:00.000Z","2016-03-04T05:00:00.000Z","2016-03-05T05:00:00.000Z","2016-03-06T05:00:00.000Z","2016-03-07T05:00:00.000Z","2016-03-08T05:00:00.000Z","2016-03-09T05:00:00.000Z","2016-03-10T05:00:00.000Z","2016-03-11T05:00:00.000Z","2016-03-12T05:00:00.000Z","2016-03-13T05:00:00.000Z","2016-03-14T05:00:00.000Z","2016-03-15T05:00:00.000Z","2016-03-16T05:00:00.000Z","2016-03-17T05:00:00.000Z","2016-03-18T05:00:00.000Z","2016-03-19T05:00:00.000Z","2016-03-20T05:00:00.000Z","2016-03-21T05:00:00.000Z","2016-03-22T05:00:00.000Z","2016-03-23T05:00:00.000Z","2016-03-24T05:00:00.000Z","2016-03-25T05:00:00.000Z","2016-03-26T05:00:00.000Z","2016-03-27T05:00:00.000Z","2016-03-28T05:00:00.000Z","2016-03-29T05:00:00.000Z","2016-03-30T05:00:00.000Z","2016-03-31T05:00:00.000Z","2016-04-01T05:00:00.000Z","2016-04-02T05:00:00.000Z","2016-04-03T05:00:00.000Z","2016-04-04T05:00:00.000Z","2016-04-05T05:00:00.000Z","2016-04-06T05:00:00.000Z","2016-04-07T05:00:00.000Z","2016-04-08T05:00:00.000Z","2016-04-09T05:00:00.000Z","2016-04-10T05:00:00.000Z","2016-04-11T05:00:00.000Z","2016-04-12T05:00:00.000Z","2016-04-13T05:00:00.000Z","2016-04-14T05:00:00.000Z","2016-04-15T05:00:00.000Z","2016-04-16T05:00:00.000Z","2016-04-17T05:00:00.000Z","2016-04-18T05:00:00.000Z","2016-04-19T05:00:00.000Z","2016-04-20T05:00:00.000Z","2016-04-21T05:00:00.000Z","2016-04-22T05:00:00.000Z","2016-04-23T05:00:00.000Z","2016-04-24T05:00:00.000Z","2016-04-25T05:00:00.000Z","2016-04-26T05:00:00.000Z","2016-04-27T05:00:00.000Z","2016-04-28T05:00:00.000Z","2016-04-29T05:00:00.000Z","2016-04-30T05:00:00.000Z","2016-05-01T05:00:00.000Z","2016-05-02T05:00:00.000Z","2016-05-03T05:00:00.000Z","2016-05-04T05:00:00.000Z","2016-05-05T05:00:00.000Z","2016-05-06T05:00:00.000Z","2016-05-07T05:00:00.000Z","2016-05-08T05:00:00.000Z","2016-05-09T05:00:00.000Z","2016-05-10T05:00:00.000Z","2016-05-11T05:00:00.000Z","2016-05-12T05:00:00.000Z","2016-05-13T05:00:00.000Z","2016-05-14T05:00:00.000Z","2016-05-15T05:00:00.000Z","2016-05-16T05:00:00.000Z","2016-05-17T05:00:00.000Z","2016-05-18T05:00:00.000Z","2016-05-19T05:00:00.000Z","2016-05-20T05:00:00.000Z","2016-05-21T05:00:00.000Z","2016-05-22T05:00:00.000Z","2016-05-23T05:00:00.000Z","2016-05-24T05:00:00.000Z","2016-05-25T05:00:00.000Z","2016-05-26T05:00:00.000Z","2016-05-27T05:00:00.000Z","2016-05-28T05:00:00.000Z","2016-05-29T05:00:00.000Z","2016-05-30T05:00:00.000Z","2016-05-31T05:00:00.000Z"],[0.430168046153846,0.430107700694444,0.423798392361112,0.41862248125,0.414741227777777,0.411945972916665,0.411846204861111,0.416561824305555,0.462936875,0.523903196527778,0.528644405555556,0.518331725694445,0.505054759722222,0.508102789583333,0.54108345625,0.54809035,0.556848628472222,0.546661420833333,0.520252977777778,0.4870833,0.466320918055556,0.452292097222222,0.443674098611111,0.437497303472223,0.433537697916667,0.430260617361111,0.435971665972222,0.5267264625,0.556319865972222,0.537468719444444,0.589001406944445,0.627570381944444,0.553391852777778,0.511364434027778,0.480054079861111,0.459252395833333,0.448348170833334,0.475991577777778,0.491694242361111,0.476083125694444,0.463985152777778,0.459759978472222,0.457627800694444,0.451837350694443,0.449983297916667,0.465558296527778,0.512177452083333,0.553635503472222,0.566474322222222,0.555523898611111,0.538204942361112,0.531960620138889,0.556681904166667,0.523569415277778,0.490026761805555,0.470992036111112,0.464969585416666,0.456065359027777,0.447705464583333,0.441843309722223,0.435474390277778,0.431758417361111,0.428770336805555,0.423669931944445,0.418957663194445,0.415063625694444,0.410037872916667,0.411946436111111,0.424401702083333,0.414786883333334,0.408840069444444,0.404278209027778,0.400777049305556,0.431435730555556,0.465524620138889,0.494399163194444,0.472469815277778,0.451268077083333,0.437301065277778,0.427898465972222,0.418709924305556,0.412280579166667,0.406131967361111,0.4004319125,0.395331911805555,0.390481098611111,0.395603961805555,0.396951645138889,0.389334978472222,0.39280853125,0.395542963194445,0.386423522222223]]},"evals":[],"jsHooks":[]}</script><p>You can also use the <code><a href="../reference/ODMtools.html">ODMtools()</a></code> addin. It will recognize any dataframe that you have that fits the general structure of the ODM data values table. Specifically containing a LocalDateTime column and a Datavalue column.</p>
</div>
<div id="editing-data" class="section level2">
<h2 class="hasAnchor">
<a href="#editing-data" class="anchor"></a>Editing data</h2>
<p>The <code><a href="../reference/ODMtools.html">ODMtools()</a></code> addin includes a console to evaluate R expressions. You can use the function <code>Data()</code> to access the underlying data for the plot and interact with it. You can also write back to this data using the same function enabling you to make changes to selected points. Useful code bits that can be run in ODMtools are below.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">values<span class="op">$</span>ODMdata <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">LocalDateTime =</span> <span class="kw">floor_date</span>(LocalDateTime, <span class="st">"hour"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(label <span class="op">==</span><span class="st"> "15_236_46_0"</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">inner_join</span>(<span class="kw">Data</span>(), <span class="dt">by =</span> <span class="st">"LocalDateTime"</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Diff =</span> DataValue.x <span class="op">-</span><span class="st"> </span>DataValue.y) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">select</span>(Diff) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summary</span>()

<span class="kw">Data</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">DataValue =</span> DataValue <span class="op">-</span><span class="st"> </span><span class="fl">0.108</span>,
  <span class="dt">QualifierID =</span> <span class="dv">106</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">Data</span>()</code></pre></div>
</div>
<div id="importing-data-into-the-odm-database" class="section level2">
<h2 class="hasAnchor">
<a href="#importing-data-into-the-odm-database" class="anchor"></a>Importing data into the ODM database</h2>
<p>From an active R session in Rstudio you can import csv or excel files using Rstudio.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readr)
PC1_CR1000_Weir &lt;-<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"PC1_CR1000_Weir.dat"</span>, 
    <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">TIMESTAMP =</span> <span class="kw">col_datetime</span>(<span class="dt">format =</span> <span class="st">"%Y-%m-%d %H:%M:%S"</span>)))</code></pre></div>
<p><code><a href="../reference/ODMcreate.html">ODMcreate()</a></code> can be used to create a dataframe with all the required data for importing into ODM.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">PC1_new &lt;-<span class="st"> </span><span class="kw"><a href="../reference/ODMcreate.html">ODMcreate</a></span>(PC1_CR1000_Weir<span class="op">$</span>TIMESTAMP, PC1_CR1000_Weir<span class="op">$</span>ShaftEnc_Avg, 
  <span class="dt">SiteID =</span> <span class="dv">15</span>, <span class="dt">VariableID =</span> <span class="dv">8</span>, <span class="dt">MethodID =</span> <span class="dv">1</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/ODMload.html">ODMload</a></span>(ODM,PC1_new, <span class="dt">QCcheck =</span> <span class="dv">0</span>)</code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#odbc">ODBC</a></li>
      <li><a href="#the-basics">The Basics</a></li>
      <li><a href="#addins">Addins</a></li>
      <li><a href="#visualising-data">Visualising Data</a></li>
      <li><a href="#editing-data">Editing data</a></li>
      <li><a href="#importing-data-into-the-odm-database">Importing data into the ODM database</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Chris McConnell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
